<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interview Study Plan</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container my-5">
    <h1 class="text-center mb-4">📚 Interview Study Plan (1 - 1.5 Weeks)</h1>

    <div class="mb-3">
        <input type="text" class="form-control" id="subPlanInput" placeholder="Nhập kế hoạch nhỏ (ví dụ: Kiểm tra lại Spring Boot Config)">
        <button class="btn btn-success mt-2" onclick="addSubPlan()">Thêm Kế Hoạch Nhỏ</button>
    </div>

    <div id="subPlans" class="mb-4"></div>

    <div id="plan"></div>

    <button class="btn btn-primary mt-4" onclick="markAllDone()">Mark All as Done</button>
</div>

<script>
const STORAGE_KEY_MAIN = "interview_plan_status";
const STORAGE_KEY_SUB = "sub_plans";

const planData = [
    { day: 1, topic: "Microservices & Kiến trúc", knowledge: ["Microservices vs Monolithic", "Ưu/Nhược điểm, Anti-patterns", "API Gateway, Circuit Breaker, Saga, CQRS"], questions: ["Tại sao chọn Microservices?", "Giao tiếp giữa các service như thế nào?"] },
    { day: 2, topic: "Spring Boot Core & Cấu trúc Dự Án", knowledge: ["Spring Context, Dependency Injection, Bean Lifecycle", "Annotation: @Component, @Service, @Repository, @Controller, @RestController, @Configuration", "Cấu trúc chuẩn project Spring Boot"], questions: ["Khi nào dùng @Component và @Bean?", "Bean được khởi tạo như thế nào?"] },
    { day: 3, topic: "Spring Boot Advanced & Exception Handling", knowledge: ["@Transactional, Propagation & Isolation", "Exception Handling: @ControllerAdvice, @ExceptionHandler", "Validation: @Valid, Custom Validator"], questions: ["Khi nào rollback không hoạt động?", "Xử lý Exception trong REST API như thế nào?"] },
    { day: 4, topic: "Spring Security & OAuth2 (Optional)", knowledge: ["Authentication vs Authorization", "JWT Token Flow, OAuth2 Flow", "Spring Security Filter Chain"], questions: ["JWT có nhược điểm gì?", "Khi nào nên dùng OAuth2?"] },
    { day: 5, topic: "PostgreSQL", knowledge: ["MVCC, Transaction Isolation Levels", "Indexing: B-Tree, GiST, GIN", "Query Execution Plan (EXPLAIN ANALYZE)"], questions: ["Khi nào Index không được sử dụng?", "Giải thích MVCC và Vacuum."] },
    { day: 6, topic: "Redis & Caching Patterns", knowledge: ["Redis Data Structures", "Cache Aside, Write Through, Write Behind", "TTL, Eviction Policies: LRU, LFU, FIFO"], questions: ["Khi nào cache bị stale?", "Redis có phải luôn là lựa chọn tốt?"] },
    { day: 7, topic: "Kafka", knowledge: ["Kafka Architecture", "Consumer Groups, Message Ordering", "At-least-once, Exactly-once semantics"], questions: ["Khi nào xảy ra message loss?", "Kafka và RabbitMQ khác nhau như thế nào?"] },
    { day: 8, topic: "Elasticsearch & Logging", knowledge: ["Elasticsearch Concepts", "Query vs Filter Context", "Logging Stack: ELK/EFK"], questions: ["Khi nào không nên dùng Elasticsearch?", "Làm sao đảm bảo kết quả tìm kiếm nhanh?"] },
    { day: 9, topic: "Java Core Ôn Tập", knowledge: ["OOP, SOLID, Design Patterns", "Collections: List, Map, Set", "Concurrency: Thread, Runnable, synchronized, volatile"], questions: ["Khi nào dùng HashMap vs ConcurrentHashMap?", "Giải thích synchronized và volatile."] },
    { day: 10, topic: "Tổng Kết & Mock Interview", knowledge: ["Review toàn bộ topic", "Giải thích nhanh 3-5 phút mỗi chủ đề", "Chuẩn bị tình huống dự án"], questions: ["Vấn đề gặp phải và cách giải quyết?", "Lý do chọn giải pháp kỹ thuật?"] }
];

function saveMainPlanStatus() {
    const status = {};
    planData.forEach(item => {
        status[`day-${item.day}`] = document.getElementById(`day-${item.day}`).checked;
    });
    localStorage.setItem(STORAGE_KEY_MAIN, JSON.stringify(status));
}

function loadMainPlanStatus() {
    const status = JSON.parse(localStorage.getItem(STORAGE_KEY_MAIN));
    if (status) {
        for (const [id, checked] of Object.entries(status)) {
            const checkbox = document.getElementById(id);
            if (checkbox) checkbox.checked = checked;
        }
    }
}

function renderPlan() {
    const planContainer = document.getElementById('plan');
    planData.forEach(item => {
        planContainer.innerHTML += `
        <div class="card mb-3">
            <div class="card-header bg-primary text-white">
                ✅ Ngày ${item.day}: ${item.topic} <input type="checkbox" class="form-check-input float-end" id="day-${item.day}" onchange="saveMainPlanStatus()">
            </div>
            <div class="card-body">
                <h5>📖 Kiến thức:</h5>
                <ul>${item.knowledge.map(k => `<li>${k}</li>`).join('')}</ul>
                <h5>❓ Tự hỏi:</h5>
                <ul>${item.questions.map(q => `<li>${q}</li>`).join('')}</ul>
            </div>
        </div>`;
    });
}

function markAllDone() {
    planData.forEach(item => {
        document.getElementById(`day-${item.day}`).checked = true;
    });
    saveMainPlanStatus();
}

function addSubPlan() {
    const input = document.getElementById('subPlanInput');
    const value = input.value.trim();
    if (value) {
        const subPlans = JSON.parse(localStorage.getItem(STORAGE_KEY_SUB)) || [];
        subPlans.push({ id: `sub-${Date.now()}`, text: value, done: false });
        localStorage.setItem(STORAGE_KEY_SUB, JSON.stringify(subPlans));
        input.value = '';
        renderSubPlans();
    }
}

function toggleSubPlan(id) {
    const subPlans = JSON.parse(localStorage.getItem(STORAGE_KEY_SUB)) || [];
    const updatedPlans = subPlans.map(plan => plan.id === id ? { ...plan, done: !plan.done } : plan);
    localStorage.setItem(STORAGE_KEY_SUB, JSON.stringify(updatedPlans));
}

function renderSubPlans() {
    const subPlansContainer = document.getElementById('subPlans');
    subPlansContainer.innerHTML = '';
    const subPlans = JSON.parse(localStorage.getItem(STORAGE_KEY_SUB)) || [];
    subPlans.forEach(plan => {
        subPlansContainer.innerHTML += `
            <div class="form-check">
                <input class="form-check-input" type="checkbox" id="${plan.id}" ${plan.done ? 'checked' : ''} onchange="toggleSubPlan('${plan.id}')">
                <label class="form-check-label" for="${plan.id}">${plan.text}</label>
            </div>`;
    });
}

document.addEventListener('DOMContentLoaded', () => {
    renderPlan();
    loadMainPlanStatus();
    renderSubPlans();
});
</script>
</body>
</html>
